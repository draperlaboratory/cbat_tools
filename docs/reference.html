<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="cbat.css">
<title>CBAT reference</title>
</head>
<body>

<h1>CBAT Reference</h1>

This page contains a brief reference to CBAT's command line options.
<ul>
<li><a href="#general-options">General-purpose options</a></li>
<li><a href="#single-program">Single program analysis</a></li>
<li><a href="#comparative">Comparative analysis</a></li>
<li><a href="#smt-lib">Custom property smt-lib reference</a></li>
</ul>

<section>
<a name="general-options"></a>
<h2>General options</h2>

These options apply in most circumstances to adjust CBAT's behavior or output.

<ul>
<li><code>--inline=&lt;posix-regexp&gt;</code> &mdash; Functions specified by the provided POSIX regular expression will inlined. When functions are not inlined, heuristic function summaries are used at function call sites. For example, if you want to inline the functions <code>foo</code> and <code>bar</code>, you can write <code>--inline=foo|bar</code>. To inline everything, use <code>--inline=.*</code> (not generally recommended).</li>

<li><code>--num-unroll=&lt;num&gt;</code> &mdash; Replaces the default number of times to unroll each loop. The number of loop unrollings is 5 by default.</code></li>

<li><code>--gdb-output=&lt;my_exec.gdb&gt;</code> &mdash; Outputs a <code>gdb</code> script to file <code>my_exec.gdb</code>. From within <code>gdb</code>, run source <code>my_exec.gdb</code> to set a breakpoint at the function given by <code>--function</code> and fill the appropriate registers with a countermodel found when WP results in SAT. In the case WP returns UNSAT or UNKNOWN, no script will be outputted.</li>

<li><code>--bildb-output=&lt;filename.yml&gt;</code> &mdash; Outputs a BILDB initialization script to file <code>filename.yml</code>. This YAML file sets the registers and memory to the values specified in the countermodel found when WP returns SAT, allowing BILDB to follow the same execution trace. In the case the analysis returns UNSAT or UNKNOWN, no script will be outputted.</li>

<li><code>--use-fun-input-regs</code> &mdash; At a function call site, uses all possible input registers as arguments to a function symbol generated for an output register representing the result of the function call. If this flag is not present, no registers will be used.</li>

<li><code>--stack-base=&lt;address&gt;</code> &mdash; Sets the location of the stack frame for the function under analysis. By default, WP assumes the stack frame for the current function is between <code>0x40000000</code> and <code>0x3F800080</code>.</li>

<li><code>--stack-size=&lt;size&gt;</code> &mdash; Sets the size of the stack. <code>size</code> should be denoted in bytes. By default, the size of the stack is <code>0x800000</code>, which is 8MB.</li>

<li><code>--show=[bir|refuted-goals|paths|precond-internal|precond-smtlib]</code> &mdash; A list of details to print out from the analysis. Multiple options can be specified as a comma-separated list. For example: <code>--show=bir,refuted-goals</code>. The options are:
  <ul>
    <li><code>bir</code>: The code of the binary/binaries in BAP Immediate Representation.</li>
    <li><code>refuted-goals</code>: In the case the analysis results in SAT, a list of goals refuted in the model that contains their tagged names, the concrete values of the goals, and the Z3 representation of the goal.</li>
    <li><code>paths</code>: The execution path of the binary that results in a refuted goal. The path contains information about the jumps taken, their addresses, and the values of the registers at each jump. This option automatically prints out the refuted goals.</li>
    <li><code>precond-smtlib</code>: The precondition printed out in Z3's SMT-LIB2 format.</li>
    <li><code>precond-internal</code>: The precondition printed out in WP's internal format for the <code>Constr.t</code> type.</li>
  </ul>
</li>
<li><code>--debug=[z3-solver-stats|z3-verbose|constraint-stats|eval-constraint-stats]</code> &mdash; A list of debugging statistics to display.  Multiple statistics may be specified in a comma-separated list. For example: <code>--debug=z3-solver-stats,z3-verbose</code>. The options are:
  <ul>
    <li><code>z3-solver-stats</code>: Information and statistics about Z3's solver. It includes information such as the maximum amount of memory used and the number of allocations.</li>
    <li><code>z3-verbose</code>: Z3's verbosity level. It outputs information such as the tactics the Z3 solver used.</li>
    <li><code>constraint-stats</code>: Statistics regarding the internal <code>Constr.t</code> data structure, including the number of goals, ITES, clauses, and substitutions.</li>
    <li><code>eval-constraint-stats</code>: Statistics regarding the internal expression lists during the <code>eval</code> function.</li>
  </ul>
</li>
</ul>

</section>

<section>
<a name="single-program"></a>
<h2>Single program analysis</h2>

<p>To analyze a single program, the command you want to invoke has this basic form:

<pre>
    $ bap wp \              <-- The command is wp
        --func=FUNC \       <-- The function to examine
        [options] \         <-- Any extra options
        /path/to/exe        <-- The path to a binary program
</pre>

The following options select or adjust the property that will be checked for the function <code>FUNC</code> in the case of single-program analysis.

<ul>
<li><code>--trip-asserts</code> &mdash; Looks for inputs to the subroutine that would cause an <code>__assert_fail</code> or <code>__VERIFIER_error</code> to be reached.</li>
<li><code>--check-null-derefs</code> &mdash; Checks for inputs that would result in dereferencing a NULL address during a memory read or write. This flag also can also be used in comparative analysis; see <a href="#comparative">below</a>.</li>
<li><code>--precond=&lt;smt-lib-string&gt;</code> &mdash; Allows the introduction of assertions to the beginning of a query. This allows pruning of possible models. Assertions are specified in the <a href="#smt-lib">smt-lib2 format</a>. This flag also can also be used in comparative analysis; see <a href="#comparative">below</a>.</li>
<li><code>--postcond=&lt;smt-lib-string&gt;</code> &mdash; Replaces the default postcondition by the user-specified one, using the <a href="#smt-lib">smt-lib2 format</a>. This flag also can also be used in comparative analysis; see <a href="#comparative">below</a>.</li>
</ul>
</section>


<section>
<a name="comparative"></a>
<h2>Comparative analysis</h2>

<p>To analyze two programs,the command you want to invoke has this basic form:

<pre>
    $ bap wp \                  <-- The command is wp
        --func=FUNC \           <-- The function to examine in both programs
        [options] \             <-- Any extra options
        /path/to/exe1 \         <-- The path to the first program
        /path/to/exe2           <-- The path to the second program
</pre>

<ul>
<li><code>--check-null-derefs</code> &mdash; Check that the modified binary has no additional null dereferences in comparison with the original binary.</li>
<li><code>--compare-func-calls</code> &mdash; Compares the semantics of two programs by examining which subroutines are invoked in the body of the function.</li>
<li><code>--compare-post-reg-values=&lt;reg-list&gt;</code> &mdash; Compares the values of the registers specified <code>reg-list</code> at the end of the analyzed function's execution. If unsure about which registers to compare, x86_64 architectures place their output in RAX and ARM architectures place their output in R0.</li>
<li><code>--mem-offset</code> &mdash; Maps the symbols in the data and bss sections from their addresses in the original binary to their addresses in the modified binary. If this flag is not present, WP assumes that memory between both binaries are equal.</li>
<li><code>--precond=&lt;smt-lib-string&gt;</code> &mdash; Allows the introduction of assertions to the beginning of a query using the <a href="#smt-lib">smt-lib2 format</a>. This allows pruning of possible models. For comparative predicates, one may refer to variables in the original and modified program by appending the suffix <code>_orig</code> and <code>_mod</code> to variable names in the smt-lib expression. For example, <code>--precond="(assert (= RDI_mod #x0000000000000003)) (assert (= RDI_orig #x0000000000000003))"</code>.</li>
<li><code>--postcond=&lt;smt-lib-string&gt;</code> &mdash; Replaces the default postcondition by the user-specified one, using the <a href="#smt-lib">smt-lib2 format</a>. Similar to --precond, one may create comparative postconditions on variables by appending <code>_orig</code> and <code>_mod</code> to register names.</li>
</section>

<section>
<a name="smt-lib"></a>
<h2>Custom property cheat sheet</h2>
Custom properties use the <code>smt-lib2</code> format.  Here we provide a quick reference to commonly used features.

In the following, let <code>E1</code>, <code>E2</code>, and so on refer to <code>SMTLIB</code> expressions.

<h3>Assertion</h3>

<ul>
  <li><b>Assert</b>: <code>(assert E1)</code></li>
</ul>

<h3>Boolean operations</h3>

<ul>
  <li><b>Conjunction</b>: <code>(and E1 E2)</code></li>
  <li><b>Disjunction</b>: <code>(or E1 E2)</code></li>
  <li><b>Implies</b>: <code>(=> E1 E2)</code></li>
  <li><b>Negation</b>: <code>(not E1)</code></li>
</ul>

<h3>Arithmetic operations</h3>

<ul>
  <li><b>Equality</b>: <code>(= E1 E2)</code></li>
  <li><b>Inequality</b>: <code>(not (= E1 E2))</code></li>
  <li><b>Addition</b>: <code>(+ E1 E2)</code></li>
  <li><b>Subtraction</b>: <code>(- E1 E2)</code></li>
  <li><b>Multiplication</b>: <code>(* E1 E2)</code></li>
  <li><b>Less than</b>: <code>(< E1 E2)</code></li>
  <li><b>Less-than-or-equal-to</b>: <code>(<= E1 E2)</code></li>
  <li><b>Greater than</b>: <code>(> E1 E2)</code></li>
  <li><b>Greater-than-or-equal-to</b>: <code>(>= E1 E2)</code></li>
</ul>

<h3>Bitvector operations</h3>

<ul>
  <li><b>Bitvector addition</b>: <code>(bvadd E1 E2)</code></li>
  <li><b>Bitvector subtraction</b>: <code>(bvsub E1 E2)</code></li>
  <li><b>Bitvector unsigned less-than</b>: <code>(bvult E1 E2)</code></li>
  <li><b>Bitvector unsigned less-than-or-equal-to</b>: <code>(bvule E1 E2)</code></li>
  <li><b>Bitvector unsigned greater-than</b>: <code>(bvugt E1 E2)</code></li>
  <li><b>Bitvector unsigned greater-than-or-equal-to</b>: <code>(bvuge E1 E2)</code></li>
  <li><b>Bitvector signed less-than</b>: <code>(bvslt E1 E2)</code></li>
  <li><b>Bitvector signed less-than-or-equal-to</b>: <code>(bvsle E1 E2)</code></li>
  <li><b>Bitvector signed greater-than</b>: <code>(bvsgt E1 E2)</code></li>
  <li><b>Bitvector signed greater-than-or-equal-to</b>: <code>(bvsge E1 E2)</code></li>
</ul>

</section>

</body>
</html>
