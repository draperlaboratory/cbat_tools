<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Constraint (bap_wp.Bap_wp.Constraint)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">bap_wp</a> &#x00BB; <a href="../index.html">Bap_wp</a> &#x00BB; Constraint</nav><header class="odoc-preamble"><h1>Module <code><span>Bap_wp.Constraint</span></code></h1><p>This module implements the abstract data type of constraints which can be used as the input to the <a href="../Precondition/index.html"><code>Precondition</code></a> module. These can then be used, e.g. to re-construct the counter-examples found by the verification process.</p><p>For the most part, there are only 3 kinds of constraints:</p><p>1. A constraint directly encoded by a Z3 expression, tagged by a name. Created with <a href="#val-mk_goal"><code>mk_goal</code></a></p><p>2. An if-then-else constraint. This constraint encodes a branch, along with the <code>tid</code> of the branch location in BIL code, the branch condition, expressed as a Z3 expression, and the constraints along both branches. Created with <a href="#val-mk_ite"><code>mk_ite</code></a>.</p><p>3. A clause constraint. Basically used for conjunctions of verification constraints and assumptions, of the form <code>A1 /\ ... /\
   An ==&gt; V1 /\ ... /\ Vk</code> where the Ais and Vjs are assumptions and verification constraints, respectively.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-z3_expr" class="anchored"><a href="#type-z3_expr" class="anchor"></a><code><span><span class="keyword">type</span> z3_expr</span><span> = <span class="xref-unresolved">Z3</span>.Expr.expr</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The base type of constraints.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-goal" class="anchored"><a href="#type-goal" class="anchor"></a><code><span><span class="keyword">type</span> goal</span></code></div><div class="spec-doc"><p>A goal is simply a Z3 (boolean) expression tagged with a name.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-path" class="anchored"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">type</span> path</span><span> = <span>bool <span class="xref-unresolved">Bap</span>.Std.Jmp.Map.t</span></span></code></div><div class="spec-doc"><p>A path tracks an execution path by mapping <code>jmp</code>s of branches to a boolean, which marks whether the path was taken or not.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-refuted_goal" class="anchored"><a href="#type-refuted_goal" class="anchor"></a><code><span><span class="keyword">type</span> refuted_goal</span></code></div><div class="spec-doc"><p>A goal that has been refuted by the Z3 model during WP analysis. Contains the path taken in the binary to reach the goal, as well as a map of register values at each jump in the path.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_goal" class="anchored"><a href="#val-mk_goal" class="anchor"></a><code><span><span class="keyword">val</span> mk_goal : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-z3_expr">z3_expr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-goal">goal</a></span></code></div><div class="spec-doc"><p><code>mk_goal name e</code> creates a goal using a Z3 boolean expression and a name.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-goal_to_string" class="anchored"><a href="#val-goal_to_string" class="anchor"></a><code><span><span class="keyword">val</span> goal_to_string : <span>?colorful:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-goal">goal</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Creates a string representation of a goal.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-expr_to_hex" class="anchored"><a href="#val-expr_to_hex" class="anchor"></a><code><span><span class="keyword">val</span> expr_to_hex : <span><a href="#type-z3_expr">z3_expr</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Creates a string representation of a Z3 numeral as a hexadecimal in BAP notation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-format_values" class="anchored"><a href="#val-format_values" class="anchor"></a><code><span><span class="keyword">val</span> format_values : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span>(string * <a href="#type-z3_expr">z3_expr</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Creates a string representation of a mapping of BAP variable names to their <code>z3_expr</code>s.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-format_refuted_goal" class="anchored"><a href="#val-format_refuted_goal" class="anchor"></a><code><span><span class="keyword">val</span> format_refuted_goal : 
  <span><a href="#type-refuted_goal">refuted_goal</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Z3</span>.Model.model <span class="arrow">&#45;&gt;</span></span>
  <span>orig:<span>(<span><a href="#type-z3_expr">z3_expr</a> <span class="xref-unresolved">Bap</span>.Std.Var.Map.t</span> * <span class="xref-unresolved">Bap</span>.Std.Sub.t)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>modif:<span>(<span><a href="#type-z3_expr">z3_expr</a> <span class="xref-unresolved">Bap</span>.Std.Var.Map.t</span> * <span class="xref-unresolved">Bap</span>.Std.Sub.t)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>print_path:bool <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p>Creates a string representation of a goal that has been refuted given the model. This string shows the lhs and rhs of a goal that compares two values. If print_path is set, it also shows the path taken to reach the refuted goal and the register values along that path.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-goal_of_refuted_goal" class="anchored"><a href="#val-goal_of_refuted_goal" class="anchor"></a><code><span><span class="keyword">val</span> goal_of_refuted_goal : <span><a href="#type-refuted_goal">refuted_goal</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-goal">goal</a></span></code></div><div class="spec-doc"><p>Obtains the goal data type from a refuted goal.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_goal_name" class="anchored"><a href="#val-get_goal_name" class="anchor"></a><code><span><span class="keyword">val</span> get_goal_name : <span><a href="#type-goal">goal</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Obtains a goal's tagged name.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_goal_val" class="anchored"><a href="#val-get_goal_val" class="anchor"></a><code><span><span class="keyword">val</span> get_goal_val : <span><a href="#type-goal">goal</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-z3_expr">z3_expr</a></span></code></div><div class="spec-doc"><p>Obtains the <code>z3_expr</code> representing the value of the goal.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_string" class="anchored"><a href="#val-to_string" class="anchor"></a><code><span><span class="keyword">val</span> to_string : <span>?colorful:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Creates a string representation of a constraint.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pp" class="anchored"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span>?colorful:bool <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Pretty prints a constraint.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_constr" class="anchored"><a href="#val-mk_constr" class="anchor"></a><code><span><span class="keyword">val</span> mk_constr : <span><a href="#type-goal">goal</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Creates a constraint made of a single goal.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_ite" class="anchored"><a href="#val-mk_ite" class="anchor"></a><code><span><span class="keyword">val</span> mk_ite : <span><span class="xref-unresolved">Bap</span>.Std.Jmp.t <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-z3_expr">z3_expr</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>mk_ite jmp e lc rc</code> creates an if-then-else constraint representing a branch at <code>jmp</code> with constraint <code>e</code>, which has the constraints <code>lc</code> if <code>e</code> is true and <code>rc</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_clause" class="anchored"><a href="#val-mk_clause" class="anchor"></a><code><span><span class="keyword">val</span> mk_clause : <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>mk_clause [a1;...,an] [v1;...;vm]</code> creates the constraint <code>a1 /\ ... /\ an ==&gt; v1 /\ ... /\ vm</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-eval" class="anchored"><a href="#val-eval" class="anchor"></a><code><span><span class="keyword">val</span> eval : <span>?debug:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Z3</span>.context <span class="arrow">&#45;&gt;</span></span> <a href="#type-z3_expr">z3_expr</a></span></code></div><div class="spec-doc"><p><code>eval c ctx</code> evaluates the constraint <code>c</code> to a Z3 expression, using the standard Z3 encoding of if-then-else and clauses. If ~debug is called and is set to true, then statistics for eval will be printed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-substitute" class="anchored"><a href="#val-substitute" class="anchor"></a><code><span><span class="keyword">val</span> substitute : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-z3_expr">z3_expr</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-z3_expr">z3_expr</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>substitute c [e1;...;e_n] [d1;...;d_n]</code> substitutes each occurence in <code>c</code> of the Z3 expression <code>ei</code> with the expression <code>di</code>. This is used extensively in the weakest precondition calculus.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-substitute_one" class="anchored"><a href="#val-substitute_one" class="anchor"></a><code><span><span class="keyword">val</span> substitute_one : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-z3_expr">z3_expr</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-z3_expr">z3_expr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>substitute_one c e d</code> is equivalent to <code>substitute c [e] [d]</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_refuted_goals" class="anchored"><a href="#val-get_refuted_goals" class="anchor"></a><code><span><span class="keyword">val</span> get_refuted_goals : 
  <span>?filter_out:<span><a href="#type-z3_expr">z3_expr</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Z3</span>.Solver.solver <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Z3</span>.context <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-refuted_goal">refuted_goal</a> <span class="xref-unresolved">Bap</span>.Std.Seq.t</span></span></code></div><div class="spec-doc"><p><code>get_refuted_goals ~filter c solver ctx</code> obtains a list of goals that have been refuted by a Z3 model. The register map in the refuted goal will not save any z3 variable in <code>filter</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-eval_model_exn" class="anchored"><a href="#val-eval_model_exn" class="anchor"></a><code><span><span class="keyword">val</span> eval_model_exn : <span><span class="xref-unresolved">Z3</span>.Model.model <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-z3_expr">z3_expr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-z3_expr">z3_expr</a></span></code></div><div class="spec-doc"><p>Evaluates an expression in the current model. May raise an error if evaluation fails in the case that the argument contains quantifiers, is partial, or is not well-sorted.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_model_exn" class="anchored"><a href="#val-get_model_exn" class="anchor"></a><code><span><span class="keyword">val</span> get_model_exn : <span><span class="xref-unresolved">Z3</span>.Solver.solver <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Z3</span>.Model.model</span></code></div><div class="spec-doc"><p>Gets the model of the last check to the Z3 solver. An error will be raised if retrieving the model fails in the case that <code>check</code> was not yet called to the solver or the result of the last <code>check</code> did not result in SAT.</p></div></div><p>stats, get_stats and print_stats are used for debugging purposes when the flag --wp-debug=constraint-stats is set. *</p><div class="odoc-spec"><div class="spec type" id="type-stats" class="anchored"><a href="#type-stats" class="anchor"></a><code><span><span class="keyword">type</span> stats</span></code></div><div class="spec-doc"><p>Contains statistics for values of type t, keeping track of number of goals, ites, clauses and subs that compose t *</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_stats" class="anchored"><a href="#val-get_stats" class="anchor"></a><code><span><span class="keyword">val</span> get_stats : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-stats">stats</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>get_stats t stats</code> collects statistics of t, so that the statistics are held in stats *</p></div></div><div class="odoc-spec"><div class="spec value" id="val-print_stats" class="anchored"><a href="#val-print_stats" class="anchor"></a><code><span><span class="keyword">val</span> print_stats : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>print_stats t</code> calls get_stats to collect and print the statistics for the number of goals, ites, clauses and subs that compose t *</p></div></div><div class="odoc-spec"><div class="spec value" id="val-trivial" class="anchored"><a href="#val-trivial" class="anchor"></a><code><span><span class="keyword">val</span> trivial : <span><span class="xref-unresolved">Z3</span>.context <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>trivial ctx</code> generates a trivial constraint of <code>true</code>.</p></div></div></div></body></html>