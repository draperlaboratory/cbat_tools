<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Constraint (bap_wp.Bap_wp.Constraint)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">bap_wp</a> &#x00BB; <a href="../index.html">Bap_wp</a> &#x00BB; Constraint</nav><h1>Module <code>Bap_wp.Constraint</code></h1></header><aside><p>This module implements the abstract data type of constraints which can be used as the input to the <a href="../Precondition/index.html"><code>Precondition</code></a> module. These can then be used, e.g. to re-construct the counter-examples found by the verification process.</p><p>For the most part, there are only 3 kinds of constraints:</p><p>1. A constraint directly encoded by a Z3 expression, tagged by a name. Created with <a href="index.html#val-mk_goal"><code>mk_goal</code></a></p><p>2. An if-then-else constraint. This constraint encodes a branch, along with the <code>tid</code> of the branch location in BIL code, the branch condition, expressed as a Z3 expression, and the constraints along both branches. Created with <a href="index.html#val-mk_ite"><code>mk_ite</code></a>.</p><p>3. A clause constraint. Basically used for conjunctions of verification constraints and assumptions, of the form <code>A1 /\ ... /\
   An ==&gt; V1 /\ ... /\ Vk</code> where the Ais and Vjs are assumptions and verification constraints, respectively.</p></aside><dl><dt class="spec type" id="type-z3_expr"><a href="#type-z3_expr" class="anchor"></a><code><span class="keyword">type</span> z3_expr</code><code> = Z3.Expr.expr</code></dt><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The base type of constraints.</p></dd></dl><dl><dt class="spec type" id="type-goal"><a href="#type-goal" class="anchor"></a><code><span class="keyword">type</span> goal</code></dt><dd><p>A goal is simply a Z3 (boolean) expression tagged with a name.</p></dd></dl><dl><dt class="spec type" id="type-path"><a href="#type-path" class="anchor"></a><code><span class="keyword">type</span> path</code><code> = <span>bool Bap.Std.Jmp.Map.t</span></code></dt><dd><p>A path tracks an execution path by mapping <code>jmp</code>s of branches to a boolean, which marks whether the path was taken or not.</p></dd></dl><dl><dt class="spec type" id="type-refuted_goal"><a href="#type-refuted_goal" class="anchor"></a><code><span class="keyword">type</span> refuted_goal</code></dt><dd><p>A goal that has been refuted by the Z3 model during WP analysis. Contains the path taken in the binary to reach the goal, as well as a map of register values at each jump in the path.</p></dd></dl><dl><dt class="spec value" id="val-mk_goal"><a href="#val-mk_goal" class="anchor"></a><code><span class="keyword">val</span> mk_goal : string <span>&#45;&gt;</span> <a href="index.html#type-z3_expr">z3_expr</a> <span>&#45;&gt;</span> <a href="index.html#type-goal">goal</a></code></dt><dd><p><code>mk_goal name e</code> creates a goal using a Z3 boolean expression and a name.</p></dd></dl><dl><dt class="spec value" id="val-goal_to_string"><a href="#val-goal_to_string" class="anchor"></a><code><span class="keyword">val</span> goal_to_string : <a href="index.html#type-goal">goal</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Creates a string representation of a goal.</p></dd></dl><dl><dt class="spec value" id="val-expr_to_hex"><a href="#val-expr_to_hex" class="anchor"></a><code><span class="keyword">val</span> expr_to_hex : <a href="index.html#type-z3_expr">z3_expr</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Creates a string representation of a Z3 numeral as a hexadecimal in BAP notation.</p></dd></dl><dl><dt class="spec value" id="val-format_values"><a href="#val-format_values" class="anchor"></a><code><span class="keyword">val</span> format_values : Stdlib.Format.formatter <span>&#45;&gt;</span> <span><span>(string * <a href="index.html#type-z3_expr">z3_expr</a>)</span> list</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Creates a string representation of a mapping of BAP variable names to their <code>z3_expr</code>s.</p></dd></dl><dl><dt class="spec value" id="val-format_refuted_goal"><a href="#val-format_refuted_goal" class="anchor"></a><code><span class="keyword">val</span> format_refuted_goal : <a href="index.html#type-refuted_goal">refuted_goal</a> <span>&#45;&gt;</span> Z3.Model.model <span>&#45;&gt;</span> <span>orig:<span>(<span><a href="index.html#type-z3_expr">z3_expr</a> Bap.Std.Var.Map.t</span> * Bap.Std.Sub.t)</span></span> <span>&#45;&gt;</span> <span>modif:<span>(<span><a href="index.html#type-z3_expr">z3_expr</a> Bap.Std.Var.Map.t</span> * Bap.Std.Sub.t)</span></span> <span>&#45;&gt;</span> <span>print_path:bool</span> <span>&#45;&gt;</span> string</code></dt><dd><p>Creates a string representation of a goal that has been refuted given the model. This string shows the lhs and rhs of a goal that compares two values. If print_path is set, it also shows the path taken to reach the refuted goal and the register values along that path.</p></dd></dl><dl><dt class="spec value" id="val-goal_of_refuted_goal"><a href="#val-goal_of_refuted_goal" class="anchor"></a><code><span class="keyword">val</span> goal_of_refuted_goal : <a href="index.html#type-refuted_goal">refuted_goal</a> <span>&#45;&gt;</span> <a href="index.html#type-goal">goal</a></code></dt><dd><p>Obtains the goal data type from a refuted goal.</p></dd></dl><dl><dt class="spec value" id="val-get_goal_name"><a href="#val-get_goal_name" class="anchor"></a><code><span class="keyword">val</span> get_goal_name : <a href="index.html#type-goal">goal</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Obtains a goal's tagged name.</p></dd></dl><dl><dt class="spec value" id="val-get_goal_val"><a href="#val-get_goal_val" class="anchor"></a><code><span class="keyword">val</span> get_goal_val : <a href="index.html#type-goal">goal</a> <span>&#45;&gt;</span> <a href="index.html#type-z3_expr">z3_expr</a></code></dt><dd><p>Obtains the <code>z3_expr</code> representing the value of the goal.</p></dd></dl><dl><dt class="spec value" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span class="keyword">val</span> to_string : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Creates a string representation of a constraint.</p></dd></dl><dl><dt class="spec value" id="val-pp_constr"><a href="#val-pp_constr" class="anchor"></a><code><span class="keyword">val</span> pp_constr : Stdlib.Format.formatter <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Pretty prints a constraint.</p></dd></dl><dl><dt class="spec value" id="val-mk_constr"><a href="#val-mk_constr" class="anchor"></a><code><span class="keyword">val</span> mk_constr : <a href="index.html#type-goal">goal</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Creates a constraint made of a single goal.</p></dd></dl><dl><dt class="spec value" id="val-mk_ite"><a href="#val-mk_ite" class="anchor"></a><code><span class="keyword">val</span> mk_ite : Bap.Std.Jmp.t <span>&#45;&gt;</span> <a href="index.html#type-z3_expr">z3_expr</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>mk_ite jmp e lc rc</code> creates an if-then-else constraint representing a branch at <code>jmp</code> with constraint <code>e</code>, which has the constraints <code>lc</code> if <code>e</code> is true and <code>rc</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-mk_clause"><a href="#val-mk_clause" class="anchor"></a><code><span class="keyword">val</span> mk_clause : <span><a href="index.html#type-t">t</a> list</span> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>mk_clause [a1;...,an] [v1;...;vm]</code> creates the constraint <code>a1 /\ ... /\ an ==&gt; v1 /\ ... /\ vm</code>.</p></dd></dl><dl><dt class="spec value" id="val-eval"><a href="#val-eval" class="anchor"></a><code><span class="keyword">val</span> eval : <span>?&#8288;debug:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Z3.context <span>&#45;&gt;</span> <a href="index.html#type-z3_expr">z3_expr</a></code></dt><dd><p><code>eval c ctx</code> evaluates the constraint <code>c</code> to a Z3 expression, using the standard Z3 encoding of if-then-else and clauses. If ~debug is called and is set to true, then statistics for eval will be printed.</p></dd></dl><dl><dt class="spec value" id="val-substitute"><a href="#val-substitute" class="anchor"></a><code><span class="keyword">val</span> substitute : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-z3_expr">z3_expr</a> list</span> <span>&#45;&gt;</span> <span><a href="index.html#type-z3_expr">z3_expr</a> list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>substitute c [e1;...;e_n] [d1;...;d_n]</code> substitutes each occurence in <code>c</code> of the Z3 expression <code>ei</code> with the expression <code>di</code>. This is used extensively in the weakest precondition calculus.</p></dd></dl><dl><dt class="spec value" id="val-substitute_one"><a href="#val-substitute_one" class="anchor"></a><code><span class="keyword">val</span> substitute_one : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-z3_expr">z3_expr</a> <span>&#45;&gt;</span> <a href="index.html#type-z3_expr">z3_expr</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>substitute_one c e d</code> is equivalent to <code>substitute c [e] [d]</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_refuted_goals"><a href="#val-get_refuted_goals" class="anchor"></a><code><span class="keyword">val</span> get_refuted_goals : <span>?&#8288;filter_out:<span><a href="index.html#type-z3_expr">z3_expr</a> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Z3.Solver.solver <span>&#45;&gt;</span> Z3.context <span>&#45;&gt;</span> <span><a href="index.html#type-refuted_goal">refuted_goal</a> Bap.Std.Seq.t</span></code></dt><dd><p><code>get_refuted_goals ~filter c solver ctx</code> obtains a list of goals that have been refuted by a Z3 model. The register map in the refuted goal will not save any z3 variable in <code>filter</code>.</p></dd></dl><dl><dt class="spec value" id="val-eval_model_exn"><a href="#val-eval_model_exn" class="anchor"></a><code><span class="keyword">val</span> eval_model_exn : Z3.Model.model <span>&#45;&gt;</span> <a href="index.html#type-z3_expr">z3_expr</a> <span>&#45;&gt;</span> <a href="index.html#type-z3_expr">z3_expr</a></code></dt><dd><p>Evaluates an expression in the current model. May raise an error if evaluation fails in the case that the argument contains quantifiers, is partial, or is not well-sorted.</p></dd></dl><dl><dt class="spec value" id="val-get_model_exn"><a href="#val-get_model_exn" class="anchor"></a><code><span class="keyword">val</span> get_model_exn : Z3.Solver.solver <span>&#45;&gt;</span> Z3.Model.model</code></dt><dd><p>Gets the model of the last check to the Z3 solver. An error will be raised if retrieving the model fails in the case that <code>check</code> was not yet called to the solver or the result of the last <code>check</code> did not result in SAT.</p></dd></dl><aside><p>stats, get_stats and print_stats are used for debugging purposes when the flag --wp-debug=constraint-stats is set. *</p></aside><dl><dt class="spec type" id="type-stats"><a href="#type-stats" class="anchor"></a><code><span class="keyword">type</span> stats</code></dt><dd><p>Contains statistics for values of type t, keeping track of number of goals, ites, clauses and subs that compose t *</p></dd></dl><dl><dt class="spec value" id="val-get_stats"><a href="#val-get_stats" class="anchor"></a><code><span class="keyword">val</span> get_stats : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-stats">stats</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>get_stats t stats</code> collects statistics of t, so that the statistics are held in stats *</p></dd></dl><dl><dt class="spec value" id="val-print_stats"><a href="#val-print_stats" class="anchor"></a><code><span class="keyword">val</span> print_stats : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>print_stats t</code> calls get_stats to collect and print the statistics for the number of goals, ites, clauses and subs that compose t *</p></dd></dl></div></body></html>