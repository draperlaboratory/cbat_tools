<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Z3_utils (bap_wp.Bap_wp.Z3_utils)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">bap_wp</a> &#x00BB; <a href="../index.html">Bap_wp</a> &#x00BB; Z3_utils</nav><header class="odoc-preamble"><h1>Module <code><span>Bap_wp.Z3_utils</span></code></h1><p>This module exports utility functions for working with Z3. Unfortunately, the module hierarchy necessitates thats some things that might naturally be placed in here have to put elsewhere, in particular any functionality required by <code>Constr</code> or <code>Env</code>.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Env" class="anchored"><a href="#module-Env" class="anchor"></a><code><span><span class="keyword">module</span> Env</span><span> = <a href="../Environment/index.html">Environment</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Constr" class="anchored"><a href="#module-Constr" class="anchor"></a><code><span><span class="keyword">module</span> Constr</span><span> = <a href="../Constraint/index.html">Constraint</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tokenize" class="anchored"><a href="#val-tokenize" class="anchor"></a><code><span><span class="keyword">val</span> tokenize : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Splits up an smtlib2 string into a list of tokens that can be parsed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-build_str" class="anchored"><a href="#val-build_str" class="anchor"></a><code><span><span class="keyword">val</span> build_str : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Builds up an smtlib2 string from a list of tokens.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_z3_name" class="anchored"><a href="#val-get_z3_name" class="anchor"></a><code><span><span class="keyword">val</span> get_z3_name : 
  <span><span><a href="../Constraint/index.html#type-z3_expr">Constr.z3_expr</a> <span class="xref-unresolved">Bap</span>.Std.Var.Map.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="xref-unresolved">Bap</span>.Std.Var.t <span class="arrow">&#45;&gt;</span></span> string )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Constraint/index.html#type-z3_expr">Constr.z3_expr</a> option</span></span></code></div><div class="spec-doc"><p>Looks up a Z3 variable's name in the map based off of the name in BIL notation. <code>fmt</code> is used to add prefixes and suffixes to a variable name. For example, init_RDI_orig.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_decls_and_symbols" class="anchored"><a href="#val-get_decls_and_symbols" class="anchor"></a><code><span><span class="keyword">val</span> get_decls_and_symbols : 
  <span><a href="../Environment/index.html#type-t">Env.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="xref-unresolved">Z3</span>.FuncDecl.func_decl * <span class="xref-unresolved">Z3</span>.Symbol.symbol)</span> list</span></span></code></div><div class="spec-doc"><p><code>get_decls_and_symbols</code> builds from a the var_map in an environment a mapping of all Z3 func_decl to their symbol. This is a helper function for <code>mk_smtlib2</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_smtlib2_single" class="anchored"><a href="#val-mk_smtlib2_single" class="anchor"></a><code><span><span class="keyword">val</span> mk_smtlib2_single : <span>?name:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Environment/index.html#type-t">Env.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="../Constraint/index.html#type-t">Constr.t</a></span></code></div><div class="spec-doc"><p><code>mk_smtlib2_single name env smtlib_str</code> takes in a string representing a valid SMT-Lib-2 statement and returns a WP constraint tagged with <code>name</code>. The variables in the SMT-Lib statements need to appear in the environment. The intended purpose of this function is generating hypothesis and postconditions for single binary analysis</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_smtlib2_single_with_vars" class="anchored"><a href="#val-mk_smtlib2_single_with_vars" class="anchor"></a><code><span><span class="keyword">val</span> mk_smtlib2_single_with_vars : 
  <span>?name:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Environment/index.html#type-t">Env.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="../Constraint/index.html#type-t">Constr.t</a> * <span>string list</span> * <span>string list</span></span></code></div><div class="spec-doc"><p><code>mk_smtlib2_single_with_vars name env smtlib_str</code> takes in a string representing a valid SMT-Lib-2 statement and returns a WP constraint tagged with <code>name</code>, as well as lists the &quot;init&quot; and non-&quot;init&quot; variables that appear in the constraint. The variables in the SMT-Lib statements need to appear in the environment. The intended purpose of this function is generating hypothesis and postconditions for single binary analysis</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_and" class="anchored"><a href="#val-mk_and" class="anchor"></a><code><span><span class="keyword">val</span> mk_and : <span><span class="xref-unresolved">Z3</span>.context <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Constraint/index.html#type-z3_expr">Constr.z3_expr</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="../Constraint/index.html#type-z3_expr">Constr.z3_expr</a></span></code></div><div class="spec-doc"><p><code>mk_and</code> is a slightly optimized version of <code>Bool.mk_and</code> that does not produce an <code>and</code> node if the number of operands is less than 2. This may improve sharing, but also improves compatibility of smtlib2 expressions with other solvers.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_external" class="anchored"><a href="#val-check_external" class="anchor"></a><code><span><span class="keyword">val</span> check_external : 
  <span><span class="xref-unresolved">Z3</span>.Solver.solver <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Z3</span>.context <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="xref-unresolved">Z3</span>.FuncDecl.func_decl * <span class="xref-unresolved">Z3</span>.Symbol.symbol)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Z3</span>.Solver.status</span></code></div><div class="spec-doc"><p><code>check_external</code> invokes an external smt solver as a process. It communicates to the process via a fairly rigid interpretation of the smtlib2 protocol. It extracts the smtlib2 query string from the given z3_solver, queries the external solver, receives a counter model if SAT. It then asserts this model back to the z3_solver, which should check quickly. This solver can then be used with the regular cbat z3 model interpretation machinery. Tested with boolector, results with other solvers may vary.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_smtlib2_compare" class="anchored"><a href="#val-mk_smtlib2_compare" class="anchor"></a><code><span><span class="keyword">val</span> mk_smtlib2_compare : 
  <span>?name:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Environment/index.html#type-t">Env.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Environment/index.html#type-t">Env.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="../Constraint/index.html#type-t">Constr.t</a></span></code></div><div class="spec-doc"><p><code>mk_smtlib2_compare</code> builds a constraint out of an smtlib2 string that can be used as a comparison predicate between an original and modified binary.</p></div></div></div></body></html>